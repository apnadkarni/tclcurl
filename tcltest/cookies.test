package require tcltest
package require -exact TclCurl 7.35.0

tcltest::test cookie-1 {cookie OK}  -setup {
    set tkn [curl::init]
} -body {
    $tkn configure -url http://localhost:9080/scgi/cookie -cookie "name=andres;lastname=garcia" -bodyvar body
    $tkn perform
    set ::body
} -cleanup {
    unset -nocomplain ::body
    $tkn cleanup
} -returnCodes {ok} -result {
cookie: andres garcia
}

tcltest::test cookie-1 {cookie OK}  -setup {
    set tkn [curl::init]
    set f [open cookie.jar w]
    puts $f "Set-Cookie: name=andres_jar"
    puts $f "Set-Cookie: lastname=garcia_jar"
    close $f
} -body {
    $tkn configure -url http://localhost:9080/scgi/cookie -cookiefile cookie.jar -bodyvar body
    $tkn perform
    set ::body
} -cleanup {
    unset -nocomplain ::body
#    file delete cookie.jar
    $tkn cleanup
} -returnCodes {ok} -result {
cookie: andres_jar garcia_jar
}

# cleanup
::tcltest::cleanupTests
return
